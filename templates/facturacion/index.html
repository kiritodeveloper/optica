{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}

{% if messages %}
    {% for message in messages %}
            {% if message.tags == 'error' %}
                <div class="alert alert-danger alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    {{ message }}
                </div>
            {% else %}
                <div class="alert alert-success alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    {{ message }}
                </div>
            {% endif %}
    {% endfor %}
{% endif %}

<style>
    /*
     * Component: Info Box
     * -------------------
     */
    .info-box {
      display: block;
      min-height: 90px;
      background: #fff;
      width: 100%;
      box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
      border-radius: 2px;
      margin-bottom: 15px;
    }
    .info-box small {
      font-size: 14px;
    }
    .info-box .progress {
      background: rgba(0, 0, 0, 0.2);
      margin: 5px -10px 5px -10px;
      height: 2px;
    }
    .info-box .progress,
    .info-box .progress .progress-bar {
      border-radius: 0;
    }
    .info-box .progress .progress-bar {
      background: #fff;
    }
    .info-box-icon {
      border-top-left-radius: 2px;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 2px;
      display: block;
      float: left;
      height: 90px;
      width: 90px;
      text-align: center;
      font-size: 45px;
      line-height: 90px;
      background: rgba(0, 0, 0, 0.2);
    }
    .info-box-icon > img {
      max-width: 100%;
    }
    .info-box-content {
      padding: 5px 10px;
      margin-left: 90px;
    }
    .info-box-number {
      display: block;
      font-weight: bold;
      font-size: 18px;
    }
    .progress-description,
    .info-box-text {
      display: block;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .info-box-text {
      text-transform: uppercase;
    }
    .info-box-more {
      display: block;
    }
    .progress-description {
      margin: 0;
    }
    /*
     * Component: Button
     * -----------------
     */
    .btn {
      border-radius: 3px;
      -webkit-box-shadow: none;
      box-shadow: none;
      border: 1px solid transparent;
    }
    .btn.uppercase {
      text-transform: uppercase;
    }
    .btn.btn-flat {
      border-radius: 0;
      -webkit-box-shadow: none;
      -moz-box-shadow: none;
      box-shadow: none;
      border-width: 1px;
    }
    .btn:active {
      -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
      -moz-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn:focus {
      outline: none;
    }
    .btn.btn-file {
      position: relative;
      overflow: hidden;
    }
    .btn.btn-file > input[type='file'] {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 100%;
      min-height: 100%;
      font-size: 100px;
      text-align: right;
      opacity: 0;
      filter: alpha(opacity=0);
      outline: none;
      background: white;
      cursor: inherit;
      display: block;
    }
    .btn-default {
      background-color: #f4f4f4;
      color: #444;
      border-color: #ddd;
    }
    .btn-default:hover,
    .btn-default:active,
    .btn-default.hover {
      background-color: #e7e7e7;
    }
    .btn-primary {
      background-color: #3c8dbc;
      border-color: #367fa9;
    }
    .btn-primary:hover,
    .btn-primary:active,
    .btn-primary.hover {
      background-color: #367fa9;
    }
    .btn-success {
      background-color: #00a65a;
      border-color: #008d4c;
    }
    .btn-success:hover,
    .btn-success:active,
    .btn-success.hover {
      background-color: #008d4c;
    }
    .btn-info {
      background-color: #00c0ef;
      border-color: #00acd6;
    }
    .btn-info:hover,
    .btn-info:active,
    .btn-info.hover {
      background-color: #00acd6;
    }
    .btn-danger {
      background-color: #dd4b39;
      border-color: #d73925;
    }
    .btn-danger:hover,
    .btn-danger:active,
    .btn-danger.hover {
      background-color: #d73925;
    }
    .btn-warning {
      background-color: #f39c12;
      border-color: #e08e0b;
    }
    .btn-warning:hover,
    .btn-warning:active,
    .btn-warning.hover {
      background-color: #e08e0b;
    }
    .btn-outline {
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
    }
    .btn-outline:hover,
    .btn-outline:focus,
    .btn-outline:active {
      color: rgba(255, 255, 255, 0.7);
      border-color: rgba(255, 255, 255, 0.7);
    }
    .btn-link {
      -webkit-box-shadow: none;
      box-shadow: none;
    }
    .btn[class*='bg-']:hover {
      -webkit-box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.2);
      box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.2);
    }
    .btn-app {
      border-radius: 3px;
      position: relative;
      padding: 15px 5px;
      margin: 0 0 10px 10px;
      min-width: 80px;
      height: 60px;
      text-align: center;
      color: #666;
      border: 1px solid #ddd;
      background-color: #f4f4f4;
      font-size: 12px;
    }
    .btn-app > .fa,
    .btn-app > .glyphicon,
    .btn-app > .ion {
      font-size: 20px;
      display: block;
    }
    .btn-app:hover {
      background: #f4f4f4;
      color: #444;
      border-color: #aaa;
    }
    .btn-app:active,
    .btn-app:focus {
      -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
      -moz-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
    .btn-app > .badge {
      position: absolute;
      top: -3px;
      right: -10px;
      font-size: 10px;
      font-weight: 400;
    }
    .borderless td, .borderless th {
        border: none;
    }
</style>


<!-- Info boxes -->
<div class="row">
<div class="col-md-3 col-sm-6 col-xs-12">
  <div class="info-box">
    <span class="info-box-icon bg-aqua"><i class="fa fa-tags"></i></span>
    <div class="info-box-content">
      <span class="info-box-text">Talonario de </span>
      <span class="info-box-text">Venta</span>
      <span class="info-box-number">{{ nro_bloque_venta }}</span>
    </div><!-- /.info-box-content -->
  </div><!-- /.info-box -->
</div><!-- /.col -->
<div class="col-md-3 col-sm-6 col-xs-12">
  <div class="info-box">
    <span class="info-box-icon bg-red"><i class="fa fa-usd"></i></span>
    <div class="info-box-content">
      <span class="info-box-text">Boleta de Venta</span>
      <span class="info-box-number"><small>N° </small>{{ nro_venta }}</span>
    </div><!-- /.info-box-content -->
  </div><!-- /.info-box -->
</div><!-- /.col -->

<!-- fix for small devices only -->
<div class="clearfix visible-sm-block"></div>

<div class="col-md-3 col-sm-6 col-xs-12">
  <div class="info-box">
    <span class="info-box-icon bg-green"><i class="fa fa-tags"></i></span>
    <div class="info-box-content">
      <span class="info-box-text">Talonario de</span>
        <span class="info-box-text">Nota de Pedido</span>
      <span class="info-box-number">{{ nro_bloque_pedido }}</span>
    </div><!-- /.info-box-content -->
  </div><!-- /.info-box -->
</div><!-- /.col -->
<div class="col-md-3 col-sm-6 col-xs-12">
  <div class="info-box">
    <span class="info-box-icon bg-yellow"><i class="fa fa-credit-card"></i></span>
    <div class="info-box-content">
      <span class="info-box-text">Nota de Pedido</span>
      <span class="info-box-number"><small>N° </small>{{ nro_pedido }}</span>
    </div><!-- /.info-box-content -->
  </div><!-- /.info-box -->
</div><!-- /.col -->
</div><!-- /.row -->



    <section class="panel panel-default">
        <header class="panel-heading ">
            <i class="fa fa-credit-card"></i> Operaciones De Venta
        </header>
        <div class="panel-body">
            <div class="row">
                <div class="col-lg-12">
                    <legend>Cliente</legend>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-12">
                    <div class="col-lg-4 col-md-4 col-sm-12 text-center">
                        <img src="{% static 'images/cliente.png' %}" width="100px">
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-12">
                        <div class="form-group">
                            <label for="BuscarCliente" class=" control-label col-sm-2">DNI</label>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="BuscarCliente" maxlength="8" onkeyup="search_client()"/>
                                    <span class="input-group-addon" onclick="search_client()">
                                        <i class="fa fa-search"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <br>
                        <button data-toggle="modal" data-target="#cliente-modal" class="btn btn-success text-center col-sm-12" id="add_cliente">Añadir Nuevo Cliente</button>
                    </div>
                </div>
                <div class="col-lg-6 col-sm-12">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <table class="table borderless text-center">
                            <tr>
                                <th id="cliente_foto" rowspan="3">No Especificado</th>
                                <th>Nombre</th>
                                <th id="cliente_nombre">No Especificado</th>
                            </tr>
                            <tr>
                                <td>Telefono</td>
                                <td id="cliente_telefono">No Especificado</td>
                            </tr>
                            <tr>
                                <td>Email</td>
                                <td id="cliente_email">No Especificado</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <legend>Añadir cosas a la canasta de compra</legend>
                </div>
                <strong style="margin: 1em 2em;">Productos</strong>
                <div class="row">
                    <form id="ProductosForm" class="form-horizontal" role="form" method="post">

                        <div class=" col-sm-10">
                            <div class="col-sm-12">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ ProductoForm.producto.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Producto</span>
                                            {{ ProductoForm.producto}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ ProductoForm.precio.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon3">S/.</span>
                                            {{ ProductoForm.precio}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                               <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ ProductoForm.cantidad.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon" id="basic-addon3">Unidades</span>
                                            {{ ProductoForm.cantidad}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <button type="submit" class="btn btn-app"><i class="fa fa-truck"></i> Añadir Producto</button>
                        </div>
<<<<<<< HEAD
                    </form>
                </div>
                <strong style="margin: 1em 2em;">Lentes Oftalmicos</strong>
                <div class="row">
                    <form id="LentesForm" class="form-horizontal" role="form" method="post">
=======
                    </div>
                    <div class="col-lg-6 col-sm-12">
                            <fieldset>
                                    <legend>Modalidades de Pago</legend>
                                      <div class="form-group">
                                          <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.tipo_recibo.label }}</strong></div>
                                          <div class="col-lg-8">
                                              {{ venta_form.tipo_recibo.errors }}
                                              {{ venta_form.tipo_recibo }}
                                          </div>
                                      </div>
                            </fieldset>
  {% comment %}                        <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.nro.label }}</strong></div>
                              <div class="col-lg-8">
                                  {{ venta_form.nro.errors }}
                                  {{ venta_form.nro }}
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.nro_nota.label }}</strong></div>
                              <div class="col-lg-8">
                                  {{ venta_form.nro_nota.errors }}
                                  {{ venta_form.nro_nota }}
                              </div>
                          </div>{% endcomment %}
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>Venta</strong></div>
                              <div class="col-lg-8">
                                    {{ nro_venta }}
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>Nota de Pedido</strong></div>
                              <div class="col-lg-8">
                                    {{ nro_pedido }}
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.importe.label }}</strong></div>
                              <div class="col-lg-8">
                                  {{ venta_form.importe.errors }}
                                  {{ venta_form.importe }}
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.observaciones.label }}</strong></div>
                              <div class="col-lg-8">
                                {{ venta_form.observaciones.errors }}
                                {{ venta_form.observaciones }}
                              </div>
                          </div>
                          <div class="form-group">
                              <div class="col-lg-4 col-sm-2 control-label"><strong>Total</strong></div>
                              <div class="col-lg-8">
                                    <button type="button" class="float-left btn btn-default" id="calcular">Calcular el Total</button>
                              </div>
                          </div>
                          <fieldset>
                              <table class="DetailTable">
                                  <tr>
                                      <td id="Total">No Calculado</td>
                                  </tr>
                              </table>
>>>>>>> FETCH_HEAD

                        <div class="col-sm-12">
                            <div class="col-sm-4">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ LenteForm.lente.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Lente</span>
                                            {{ LenteForm.lente}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4 ">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ LenteForm.complementos.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Tratamiento</span>
                                            {{ LenteForm.complementos}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                           <div class="col-sm-2">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-12">
                                        {{ LenteForm.precio.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >S/.</span>
                                            {{ LenteForm.precio}}
                                        </div>
                                    </div>
                                </div>
                           </div>
                           <div class="col-sm-2">
                                <button type="submit" class="btn btn-app"><i class="fa fa-eye"></i> Añadir Anteojo</button>
                           </div>
                        </div>
                    </form>
                </div>
            </div>
            <form id="venta_form" class="form-horizontal" role="form" action="{% url 'facturacion:index' %}" method="POST">{% csrf_token %}
                    <input type="hidden" id="NumeroProductos" name="NumeroProductos" value="0">
                    <input type="hidden" id="NumeroLentes" name="NumeroLentes" value="0">
                    <input type="hidden" id="DNI_Cliente" name="Cliente" value="">
                    <div class="row">
                        <div class="col-sm-8">
                            <legend>Canasta de Compras</legend>
                                <table class="table table-hover">
                                    <thead>
                                      <tr>
                                        <th>Descripción</th>
                                        <th>Precio</th>
                                        <th>Cantidad</th>
                                        <th>Eliminar</th>
                                      </tr>
                                    </thead>
                                    <tbody id="Sales_Car">

                                    </tbody>
                              </table>
                        </div>
                        <div class="col-lg-4">
                            <legend>Modalidades de Pago</legend>
                                <div class="row">
                                    <div class="form-group col-sm-12" style="text-align: center">
                                        <div class="control-label"><strong><abbr title="Total en Soles a pagar" class="initialism"><small>S/.</small></abbr></strong><span id="Total">0</span></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                  <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.tipo_recibo.label }}</strong></div>
                                  <div class="col-lg-8">
                                      {{ venta_form.tipo_recibo }}
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.importe.label }}</strong></div>
                                  <div class="col-lg-8">
                                      {{ venta_form.importe.errors }}
                                      {{ venta_form.importe }}
                                  </div>
                                </div>
                                <div class="form-group">
                                  <div class="col-lg-4 col-sm-2 control-label"><strong>{{ venta_form.observaciones.label }}</strong></div>
                                  <div class="col-lg-8">
                                    {{ venta_form.observaciones.errors }}
                                    {{ venta_form.observaciones }}
                                  </div>
                                </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <input class="btn btn-success enviar_formulario"  type="submit" value="Registrar Venta"/>
                    </div>
            </form>
        </div>
    </section>

{% comment %}        <div class="col-md-12">
            <section class="panel panel-default">
                <header class="panel-heading">Productos
                </header>
                <div class="panel-body PanelVenta">

                        <div id="form_detalles">
                                {% for form in DetalleFormSet %}
                                <div class="formset">
                                    <div class=" col-sm-8 col-xs-12">
                                        <div class="form-group ">
                                            <div class="no-padding-top form-field col-sm-11">
                                                {{ form.producto.errors }}
                                                <div class="input-group">
                                                    <span class="input-group-addon " >Producto</span>
                                                    {{ form.producto}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-2 col-xs-12">

                                        <div class="form-group ">
                                            <div class="no-padding-top form-field col-sm-11">
                                                {{ form.precio.errors }}
                                                <div class="input-group">
                                                    <span class="input-group-addon" id="basic-addon3">$</span>
                                                    {{ form.precio}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                   <div class="col-sm-2 col-xs-12">

                                       <div class="form-group ">
                                            <div class="no-padding-top form-field col-sm-11">
                                                {{ form.cantidad.errors }}
                                                <div class="input-group">
                                                    <span class="input-group-addon" id="basic-addon3">*</span>
                                                    {{ form.cantidad}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                {% endfor %}
                            </div>

                        {{ DetalleFormSet.management_form }}
                    </div>
                </section>
            <section class="panel panel-default">
                <header class="panel-heading CabeceraVenta">
                    Lunas Oftálmicas
                </header>
                <div class="panel-body PanelVenta">
                    <div id="form_lentes">
                        {% for form in LenteFormSet %}
                        <br>
                        <div class="formset">
                            <br>
                            <div class=" col-sm-4 col-xs-12">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-11">
                                        {{ form.lente.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Lente</span>
                                            {{ form.lente}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class=" col-sm-4 col-xs-12">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-11">
                                        {{ form.complementos.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Tratamiento</span>
                                            {{ form.complementos}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                           <div class=" col-sm-4 col-xs-12">
                                <div class="form-group ">
                                    <div class="no-padding-top form-field col-sm-11">
                                        {{ form.precio.errors }}
                                        <div class="input-group">
                                            <span class="input-group-addon " >Precio</span>
                                            {{ form.precio}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {{ LenteFormSet.management_form }}
                </div>
            </section>
        </div>{% endcomment %}





<!-- Modal -->
    <div id="cliente-modal" class="modal fade" role="dialog">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header" style="background-color: blueviolet; color: white;">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">
                    <img src="{% static 'images/cliente.png' %}" width="50px" style="margin: 0 3em 0 1em">
                    <strong>Registrar Nuevo Cliente</strong></h4>
              </div>
              <form id="client-form" class="form-horizontal" role="form" action="{% url 'cliente:GuardarCliente' %}" method="POST" enctype="multipart/form-data">
              <div class="modal-body">
                      <div id="msg">
                      </div>
                      {% csrf_token %}
                      <div class="form-group">
                          <div id="error_{{ cliente_form.dni.auto_id }}">{{ cliente_form.dni.errors }}</div>
                          <label for="{{ cliente_form.dni.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.dni.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.dni }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.nombre.auto_id }}">{{ cliente_form.nombre.errors }}</div>
                          <label for="{{ cliente_form.nombre.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.nombre.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.nombre }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.apellido.auto_id }}">{{ cliente_form.apellido.errors }}</div>
                          <label for="{{ cliente_form.apellido.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.apellido.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.apellido }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.direccion.auto_id }}">{{ cliente_form.direccion.errors }}</div>
                          <label for="{{ cliente_form.direccion.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.direccion.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.direccion }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.telefono.auto_id }}">{{ cliente_form.telefono.errors }}</div>
                          <label for="{{ cliente_form.telefono.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.telefono.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.telefono }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.email.auto_id }}">{{ cliente_form.email.errors }}</div>
                          <label for="{{ cliente_form.email.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.email.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.email }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.fecha_nacimiento.auto_id }}">{{ cliente_form.fecha_nacimiento.errors }}</div>
                          <label for="{{ cliente_form.fecha_nacimiento.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.fecha_nacimiento.label }}</label>
                          <div class="col-lg-10">
                                {{ cliente_form.fecha_nacimiento }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.ocupacion.auto_id }}">{{ cliente_form.ocupacion.errors }}</div>
                          <label for="{{ cliente_form.ocupacion.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.ocupacion.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.ocupacion }}
                          </div>
                      </div>
                      <div class="form-group">
                          <div id="error_{{ cliente_form.foto.auto_id }}">{{ cliente_form.foto.errors }}</div>
                          <label for="{{ cliente_form.foto.auto_id }}" class="col-lg-2 col-sm-2 control-label">{{ cliente_form.foto.label }}</label>
                          <div class="col-lg-10">
                              {{ cliente_form.foto }}
                          </div>
                      </div>

                  </div>
                  <div class="modal-footer" style="background-color: blueviolet; color: white;">
                    <input class="btn btn-success" type="submit" value="Registrar Nuevo Cliente" id="submit_cliente">
                    <a href="#" class="btn btn-danger" data-dismiss="modal">Cancelar</a>
                  </div>
              </form>
            </div>
          </div>
    </div>
<!-- endmodal -->

{% endblock %}
{% block application_javascript %}
    <script type="application/javascript">
        // Funcion javascript para calcular el total
        /*document.getElementById("calcular").addEventListener("click", function(event){


                var numero_productos = parseFloat($("#id_formset_producto-TOTAL_FORMS").val());
                var total = 0;
                for(var x = 0;x<numero_productos;x++)
                {
                    if( parseFloat($("#id_formset_producto-"+x+"-precio").val()) >= 0 &&  parseInt($("#id_formset_producto-"+x+"-cantidad").val()) >= 0)
                    {

                        total = total +  parseFloat($("#id_formset_producto-"+x+"-precio").val())*parseInt($("#id_formset_producto-"+x+"-cantidad").val());
                    }
                    else
                    {
                        total = "ERROR";
                        break;
                    }
                }
                var numero_lentes = parseInt( $("#id_formset_lente-TOTAL_FORMS").val() );
                for(var i = 0 ; i< numero_lentes; i++)
                {
                    if(parseFloat($("#id_formset_lente-"+i+"-precio").val())>0)
                    {
                        total = total + parseFloat($("#id_formset_lente-"+i+"-precio").val());
                    }
                    else
                    {
                        total = "Lente Sin Precio";

                        break
                    }
                }
                document.getElementById("Total").textContent = total;
            });*/

        // Document event Ready
        $( document ).ready(function() {
            var cantidad = 0;
            /*$('#form_detalles .formset').formset({
               prefix: '{{ DetalleFormSet.prefix }}',
               formCssClass: 'dynamic-formset1'
            });
            $('#form_lentes .formset').formset({
               prefix: '{{ LenteFormSet.prefix }}',
               formCssClass: 'dynamic-formset2'
            });*/
            $('#client-form').on('submit', function(event){
                event.preventDefault();
                registrar_cliente();
            });

            $('#ProductosForm').on('submit', function(event) {
                event.preventDefault();
                if( parseInt( $('#id_cantidad').val() ) > 0 )
                {
                    //Controlando el input para el número
                    var numero =  parseInt($('#NumeroProductos').val());
                    numero++; //contador de productos
                    $('#NumeroProductos').val(numero);
                    cantidad++; //contador de tr
                    //Obteniendo los datos del formulario
                    var table = document.querySelector("#Sales_Car");
                    var contenido = [];
                    contenido[0] = document.createTextNode($('#id_producto option:selected').text());
                    contenido[1] = document.createTextNode($('#ProductosForm #id_precio').val());
                    contenido[2] = document.createTextNode($('#id_cantidad').val());
                    var tr = document.createElement('tr');
                    tr.id = "tr-" + cantidad.toString();
                    contenido.forEach(function(element){
                        var td = document.createElement('td');
                        td.appendChild(element);
                        tr.appendChild(td);
                    });

                    //Agregrando boton eliminar
                    var td = document.createElement('td');
                    td.innerHTML = "<a onclick=\"eliminar(" + cantidad.toString() + ",'producto')\"><i class='fa fa-ban'></i></a>";
                    tr.appendChild(td);

                    // Creando Inputs
                    var input1 = document.createElement("input");
                    input1.type = "text";
                    input1.hidden = true;
                    input1.name = "producto-codigo-" + numero.toString();
                    input1.className = "producto_nombre";
                    input1.id = "id_producto-codigo-" + numero.toString();
                    input1.value = $('#id_producto').val();

                    var input2 = document.createElement("input");
                    input2.type = "text";
                    input2.hidden = true;
                    input2.className = "producto_precio";
                    input2.name = "producto-precio-" + numero.toString();
                    input2.id = "id_producto-precio-" + numero.toString();
                    input2.value = $('#ProductosForm  #id_precio').val();

                    var input3 = document.createElement("input");
                    input3.type = "text";
                    input3.hidden = true;
                    input3.className = "producto_cantidad";
                    input3.name = "producto-cantidad-" + numero.toString();
                    input3.id = "id_producto-cantidad-" + numero.toString();
                    input3.value = $('#id_cantidad').val();

                    tr.appendChild(input1);
                    tr.appendChild(input2);
                    tr.appendChild(input3);

                    table.appendChild(tr);
                    CalcularTotal();
                }
                else
                {
                    alert("PRODUCTOS: LA CANTIDAD DEBE SER MAYOR A CERO");
                }
            });

            $('#LentesForm').on('submit', function(event){
                event.preventDefault();
                if( parseFloat($('#LentesForm #id_precio').val()) > 0 )
                {
                    //Controlando el input para el número
                    var numero =  parseInt($('#NumeroLentes').val());
                    numero++; //contador de productos
                    $('#NumeroLentes').val(numero);
                    cantidad++; //contador de tr
                    //Obteniendo los datos del formulario
                    var table = document.querySelector("#Sales_Car");
                    var cadena = [];
                    $('#id_complementos option:selected').each(function () {
                       var $this = $(this);
                       if ($this.length) {
                            cadena.push($this.text());
                       }
                    });
                    var contenido = [];
                    contenido[0] = document.createTextNode($('#id_lente option:selected').text() + " " + cadena.join() );
                    contenido[1] = document.createTextNode($('#LentesForm #id_precio').val());
                    contenido[2] = document.createTextNode(1);
                    var tr = document.createElement('tr');
                    tr.id = "tr-" + cantidad.toString();
                    contenido.forEach(function(element){
                        var td = document.createElement('td');
                        td.appendChild(element);
                        tr.appendChild(td);
                    });

                    //Agregrando boton eliminar
                    var td = document.createElement('td');
                    td.innerHTML = "<a onclick=\"eliminar(" + cantidad.toString() + ",'lente')\"><i class='fa fa-ban'></i></a>";
                    tr.appendChild(td);

                    // Creando Inputs
                    var input1 = document.createElement("input");
                    input1.type = "text";
                    input1.hidden = true;
                    input1.className = "lente_codigo";
                    input1.name = "lente-codigo-" + numero.toString();
                    input1.id = "id_lente-codigo-" + numero.toString();
                    input1.value = $('#id_lente').val();

                    var input2 = document.createElement("select");
                    input2.type = "text";
                    input2.hidden = true;
                    input2.multiple = true;
                    input2.className = "lente_complementos";
                    input2.name = "lente-complementos-" + numero.toString();
                    input2.id = "id_lente_complementos-" + numero.toString();

                    var input3 = document.createElement("input");
                    input3.type = "text";
                    input3.hidden = true;
                    input3.className = "lente_precio";
                    input3.name = "lente-precio-" + numero.toString();
                    input3.id = "id_lente-precio-" + numero.toString();
                    input3.value = $('#LentesForm  #id_precio').val();

                    tr.appendChild(input1);
                    tr.appendChild(input2);
                    tr.appendChild(input3);

                    table.appendChild(tr);
                    $('#id_complementos option:selected').clone().appendTo('#id_lente_complementos-' + numero.toString());
                    /*for (var i = 0; i < document.getElementById('#id_lente_complementos-' + numero.toString()).options.length; i++)
                    {
                        document.getElementById('#id_lente_complementos-' + numero.toString()).options[i].selected = true;
                    }*/
                    $('#id_lente_complementos-' + numero.toString() + ' option').prop('selected', true);
                    CalcularTotal();
                }
                else
                {
                    alert("LENTES: EL PRECIO DEBE SER MAYOR A CERO");
                }
            });
        });
        $("#venta_form").on('submit',function(event){
            event.preventDefault();
            document.querySelector("#DNI_Cliente").value = $("#BuscarCliente").val();
            var total_pagar = CalcularTotal();
            var importe = parseFloat($("#id_importe").val()) ;
            if($("#id_tipo_recibo").val()=="True")
            {
                if(importe >= total_pagar)
                {
                    document.querySelector('#venta_form').submit();
                }
                else {
                    alert("BOTELA DE VENTA: EL IMPORTE DEL CLIENTE ES MENOR QUE EL TOTAL A PAGAR");
                }
            }
            else
            {
                document.querySelector('#venta_form').submit();
            }
        });

    </script>
{% endblock %}
